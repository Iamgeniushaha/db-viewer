<!--<!DOCTYPE html>-->
<!--<html lang="ko">-->
<!--<head>-->
<!--  <meta charset="UTF-8" />-->
<!--  <meta charset="UTF-8">-->
<!--  <link rel="preconnect" href="https://fonts.googleapis.com">-->
<!--  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>-->
<!--  <link href="https://fonts.googleapis.com/css2?family=Italiana&family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap" rel="stylesheet">-->

<!--  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>-->
<!--  <link rel="stylesheet" href="viewer.css">-->
<!--  <title>DB ì—°ê²° í…ŒìŠ¤íŠ¸</title>-->
<!--</head>-->

<!--<header>-->
<!--  <div id="header">-->
<!--    <div class="logo">-->
<!--      <img src="logo.svg" alt="DB Viewer Logo">-->
<!--    </div>-->
<!--    <nav class="nav-menu italiana-regular">-->
<!--      <span class="italiana-regular">Home</span>-->
<!--      <span>Price</span>-->
<!--      <span>Sign in</span>-->
<!--      <span>Sign up</span>-->
<!--    </nav>-->
<!--  </div>-->
<!--</header>-->

<!--<body>-->
<!--<div class="tabs">-->
<!--  <button class="tab-button active" onclick="openTab(event, 'connect')">DB ì—°ê²°</button>-->
<!--  <button class="tab-button" onclick="openTab(event, 'tables')">í…Œì´ë¸” ëª©ë¡</button>-->
<!--  <button class="tab-button" onclick="openTab(event, 'data')">í…Œì´ë¸” ë°ì´í„°</button>-->
<!--  <button class="tab-button" onclick="openTab(event, 'ai-bot')">AI ì±—ë´‡</button>-->
<!--</div>-->

<!--<form id="connect" class="tab-content active">-->
<!--  <input name="host" type="text" id="host" placeholder="í˜¸ìŠ¤íŠ¸ (ì˜ˆ: localhost)" value=""/>-->
<!--  <input name="port" type="text" id="port" placeholder="í¬íŠ¸ (ì˜ˆ: 3306)" value=""/>-->
<!--  <input name="user" type="text" id="user" placeholder="ì‚¬ìš©ìëª…" value=""/>-->
<!--  <input name="password" type="password" id="password" placeholder="ë¹„ë°€ë²ˆí˜¸"/>-->
<!--  <input name="database" type="text" id="database" placeholder="ë°ì´í„°ë² ì´ìŠ¤ ì´ë¦„" value=""/>-->
<!--  <button type="submit" onclick="testConnection()">ì—°ê²° í…ŒìŠ¤íŠ¸</button>-->
<!--  <div class="message" id="connection-message"></div>-->
<!--</form>-->

<!--<div id="tables" class="tab-content">-->
<!--  <p>ğŸ“¦ í…Œì´ë¸” ëª©ë¡:</p>-->
<!--  <ul id="table-list">-->
<!--    <li><a href="#" onclick="showTableData('user_acount')">user_acount</a></li>-->
<!--  </ul>-->
<!--</div>-->

<!--<div id="data" class="tab-content">-->
<!--  <h3>user_acount í…Œì´ë¸” ë°ì´í„°</h3>-->
<!--  <table>-->
<!--    <thead>-->
<!--    <tr>-->
<!--      <th>id</th>-->
<!--      <th>username</th>-->
<!--      <th>email</th>-->
<!--      <th>password</th>-->
<!--      <th>created_at</th>-->
<!--    </tr>-->
<!--    </thead>-->
<!--    <tbody>-->
<!--    <tr>-->
<!--      <td>1</td>-->
<!--      <td>coldbright</td>-->
<!--      <td>iamgeniusshaba@naver.com</td>-->
<!--      <td>â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢</td>-->
<!--      <td>2025-04-21T03:06:49.000Z</td>-->
<!--    </tr>-->
<!--    &lt;!&ndash; ì‹¤ì œ ë°ì´í„°ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ë“¤ì–´ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤ &ndash;&gt;-->
<!--    </tbody>-->
<!--  </table>-->
<!--</div>-->

<!--<div id="ai-bot" class="tab-content">-->
<!--  ì•„ ì”¨ì´ë°œ ã…ˆë«ë‹¤-->
<!--  ì´ê±° ì–´ì¼€ êµ¬í˜„í•˜ëƒ ë‹µ ì—†ë„¤-->
<!--</div>-->

<!--<script>-->
<!--  function openTab(evt, tabId) {-->
<!--    document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));-->
<!--    document.querySelectorAll('.tab-button').forEach(el => el.classList.remove('active'));-->
<!--    document.getElementById(tabId).classList.add('active');-->
<!--    evt.target.classList.add('active');-->
<!--  }-->

<!--  // function testConnection() {-->
<!--  //   const message = document.getElementById("connection-message");-->
<!--  //   // ì‹¤ì œë¡œëŠ” ë°±ì—”ë“œì™€ ì—°ë™í•´ì•¼ í•©ë‹ˆë‹¤.-->
<!--  //   message.innerHTML = "âœ… ì—°ê²°ì— ì„±ê³µí–ˆìŠµë‹ˆë‹¤!";-->
<!--  // }-->

<!--  function showTableData(tableName) {-->
<!--    // ì´ ì˜ˆì œì—ì„œëŠ” user_acount ê³ ì •ì´ë¯€ë¡œ ë°”ë¡œ í•´ë‹¹ íƒ­ ì—´ê¸°-->
<!--    const dataTab = document.querySelector('.tab-button:nth-child(3)');-->
<!--    dataTab.click(); // "í…Œì´ë¸” ë°ì´í„°" íƒ­ ì—´ê¸°-->
<!--  }-->
<!--</script>-->
<!--<script src="index.js"></script>-->
<!--</body>-->
<!--</html>-->

<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>DB ì—°ê²° í…ŒìŠ¤íŠ¸</title>
  <link rel="stylesheet" href="viewer.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Italiana&family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap" rel="stylesheet">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<header>
  <div id="header">
    <div class="logo">
      <img src="logo.svg" alt="DB Viewer Logo">
    </div>
    <nav class="nav-menu italiana-regular">
      <span>Home</span>
      <span>Price</span>
      <span>Sign in</span>
      <span>Sign up</span>
    </nav>
  </div>
</header>

<div class="tabs">
  <button class="tab-button active" onclick="openTab(event, 'connect')">DB ì—°ê²°</button>
  <button class="tab-button" onclick="openTab(event, 'tables')">í…Œì´ë¸” ëª©ë¡</button>
  <button class="tab-button" onclick="openTab(event, 'data')">í…Œì´ë¸” ë°ì´í„°</button>
  <button class="tab-button" onclick="openTab(event, 'ai-bot')">AI ì±—ë´‡</button>
</div>

<form id="connect" class="tab-content active">
  <input name="host" type="text" id="host" placeholder="í˜¸ìŠ¤íŠ¸ (ì˜ˆ: localhost)" required />
  <input name="port" type="text" id="port" placeholder="í¬íŠ¸ (ì˜ˆ: 3306)" required />
  <input name="user" type="text" id="user" placeholder="ì‚¬ìš©ìëª…" required />
  <input name="password" type="password" id="password" placeholder="ë¹„ë°€ë²ˆí˜¸" required />
  <input name="database" type="text" id="database" placeholder="ë°ì´í„°ë² ì´ìŠ¤ ì´ë¦„" required />
  <button type="submit">ì—°ê²° í…ŒìŠ¤íŠ¸</button>
  <div class="message" id="connection-message"></div>
</form>

<div id="tables" class="tab-content">
  <p>ğŸ“¦ í…Œì´ë¸” ëª©ë¡:</p>
  <ul id="table-list"></ul>
</div>

<div id="data" class="tab-content">
  <h3 id="table-name"></h3>
  <div id="table-data"></div>
</div>

<div id="ai-bot" class="tab-content">
  <p>ì´ê³³ì€ AI ì±—ë´‡ ì˜ì—­ì…ë‹ˆë‹¤. GPTë¥¼ í™œìš©í•œ ë‹¤ì–‘í•œ ëŒ€í™”ë¥¼ êµ¬í˜„í•  ìˆ˜ ìˆì–´ìš”!</p>
</div>

<script>
  // íƒ­ ì „í™˜ ê¸°ëŠ¥
  function openTab(evt, tabId) {
    document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
    document.querySelectorAll('.tab-button').forEach(el => el.classList.remove('active'));
    document.getElementById(tabId).classList.add('active');
    evt.target.classList.add('active');
  }

  // DB ì—°ê²° ë° í…Œì´ë¸” ì¡°íšŒ ê¸°ëŠ¥
  let lastConnectionInfo = null;
  document.getElementById("connect").addEventListener("submit", async (e) => {
    e.preventDefault();

    const data = {
      host: document.getElementById("host").value,
      port: document.getElementById("port").value,
      user: document.getElementById("user").value,
      password: document.getElementById("password").value,
      database: document.getElementById("database").value
    };
    lastConnectionInfo = data;

    const res = await fetch("/api/db/test-connection", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ type: "mysql", ...data }),
    });

    const json = await res.json();
    const msgEl = document.getElementById("connection-message");
    const tableList = document.getElementById("table-list");
    tableList.innerHTML = "";

    if (json.success) {
      msgEl.innerHTML = `<p>âœ… ì—°ê²°ì— ì„±ê³µí–ˆìŠµë‹ˆë‹¤!</p>`;
      if (json.tables && json.tables.length > 0) {
        json.tables.forEach(table => {
          const li = document.createElement("li");
          const a = document.createElement("a");
          a.href = "#";
          a.textContent = table;
          a.addEventListener("click", () => showTableData(table));
          li.appendChild(a);
          tableList.appendChild(li);
        });
        openTab({ target: document.querySelector('.tab-button:nth-child(2)') }, 'tables');
      } else {
        tableList.innerHTML = "<li>ğŸ“‚ í…Œì´ë¸”ì´ ì—†ìŠµë‹ˆë‹¤.</li>";
      }
    } else {
      msgEl.innerHTML = `âŒ ì‹¤íŒ¨: ${json.message}`;
    }
  });

  async function showTableData(tableName) {
    const res = await fetch("/api/db/get-table-data", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ ...lastConnectionInfo, table: tableName }),
    });

    const json = await res.json();
    const tableData = document.getElementById("table-data");
    const tableTitle = document.getElementById("table-name");

    if (json.success) {
      tableTitle.textContent = `${tableName} í…Œì´ë¸” ë°ì´í„°`;
      if (json.data.length > 0) {
        const headers = Object.keys(json.data[0]);
        const rows = json.data.map(row => `<tr>${Object.values(row).map(val => `<td>${val}</td>`).join("")}</tr>`).join("");

        tableData.innerHTML = `
          <table border="1">
            <thead><tr>${headers.map(h => `<th>${h}</th>`).join("")}</tr></thead>
            <tbody>${rows}</tbody>
          </table>`;
      } else {
        tableData.innerHTML = "<p>ğŸ“‚ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>";
      }
      openTab({ target: document.querySelector('.tab-button:nth-child(3)') }, 'data');
    } else {
      tableData.innerHTML = `<p>âŒ í…Œì´ë¸” ë°ì´í„° ì¡°íšŒ ì‹¤íŒ¨: ${json.message}</p>`;
    }
  }
</script>

</body>
</html>
